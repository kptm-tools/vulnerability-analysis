package handlers

import (
	"fmt"

	"github.com/kptm-tools/common/common/events"
	"github.com/kptm-tools/vulnerability-analysis/pkg/interfaces"
)

type NmapHandler struct {
	nmapService interfaces.INmapService
}

var _ interfaces.INmapHandler = (*NmapHandler)(nil)

func NewNmapHandler(nmapService interfaces.INmapService) *NmapHandler {
	return &NmapHandler{
		nmapService: nmapService,
	}
}

func (h *NmapHandler) RunScan(event events.ScanStartedEvent) error {
	// TODO: Implementation pending
	var targets []string
	domains := event.GetDomainValues()
	ips := event.GetIPValues()

	targets = append(targets, domains...)
	targets = append(targets, ips...)

	results, err := h.nmapService.RunScan(targets)
	if err != nil {
		return err
	}

	for _, result := range results {
		fmt.Println(result.String())
	}

	return nil

}
